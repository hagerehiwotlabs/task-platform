openapi: 3.0.3
info:
  title: Hagere Hiwot Labs Task Platform API
  version: 1.0.0
  description: |
    Professional task management API with full TypeScript support.
    
    ## Authentication
    - Register at `/auth/register`
    - Login at `/auth/login`
    - Use the returned JWT token in Authorization header
    
    ## Rate Limiting
    - 100 requests per 15 minutes per IP
    - Check headers: X-RateLimit-Limit, X-RateLimit-Remaining
    
    ## Error Handling
    All errors follow the ErrorResponse schema with consistent structure.
    
  contact:
    name: Hagere Hiwot Labs Team
    email: team@hagerehiwotlabs.dev
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

externalDocs:
  description: API Documentation
  url: https://docs.hagerehiwotlabs.dev/api

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://api.hagerehiwotlabs.dev/api/v1
    description: Production server

tags:
  - name: Authentication
    description: User registration, login, and token management
  - name: Projects
    description: Project management operations
  - name: Tasks
    description: Task management within projects
  - name: Users
    description: User profile management

paths:
  /health:
    get:
      operationId: getHealth
      summary: System health check
      tags: [System]
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/register:
    post:
      operationId: registerUser
      summary: Register new user
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              basic:
                summary: Basic registration
                value:
                  name: "John Doe"
                  email: "john@example.com"
                  password: "SecurePass123!"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      operationId: loginUser
      summary: Authenticate user
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              basic:
                summary: Basic login
                value:
                  email: "john@example.com"
                  password: "SecurePass123!"
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/RateLimitError'

  /auth/logout:
    post:
      operationId: logoutUser
      summary: Logout user (invalidate token)
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Successfully logged out"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/me:
    get:
      operationId: getCurrentUser
      summary: Get current user profile
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /projects:
    get:
      operationId: listProjects
      summary: List all projects for current user
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of projects with pagination
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedProjects'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      operationId: createProject
      summary: Create new project
      tags: [Projects]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /projects/{projectId}:
    get:
      operationId: getProject
      summary: Get project by ID
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      operationId: updateProject
      summary: Update project
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      operationId: deleteProject
      summary: Delete project
      tags: [Projects]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '204':
          description: Project deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'

  /projects/{projectId}/tasks:
    get:
      operationId: listProjectTasks
      summary: List tasks in project
      tags: [Tasks]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/StatusFilter'
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: List of tasks with pagination
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedTasks'
        '404':
          $ref: '#/components/responses/NotFoundError'

    post:
      operationId: createTask
      summary: Create new task in project
      tags: [Tasks]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: Task created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: >
        JWT token obtained from login endpoint.
        Format: `Bearer {token}`

  parameters:
    ProjectId:
      name: projectId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Project identifier
      example: "550e8400-e29b-41d4-a716-446655440000"

    Page:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number

    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      description: Number of items per page

    StatusFilter:
      name: status
      in: query
      required: false
      schema:
        type: string
        enum: [todo, in_progress, done]
      description: Filter tasks by status

  responses:
    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    UnauthorizedError:
      description: Authentication required or invalid token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    RateLimitError:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    # === CORE ENTITIES ===
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          minLength: 2
          maxLength: 100
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
      required: [id, name, email, createdAt]

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          minLength: 1
          maxLength: 100
          example: "Website Redesign"
        description:
          type: string
          nullable: true
          example: "Complete overhaul of company website"
        ownerId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
      required: [id, name, ownerId, createdAt]

    Task:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: "Implement login page"
        description:
          type: string
          nullable: true
          example: "Create responsive login form with validation"
        status:
          type: string
          enum: [todo, in_progress, done]
          default: todo
          example: "todo"
        priority:
          type: string
          enum: [low, medium, high]
          default: medium
          example: "medium"
        assigneeId:
          type: string
          format: uuid
          nullable: true
          example: "550e8400-e29b-41d4-a716-446655440000"
        projectId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        dueDate:
          type: string
          format: date-time
          nullable: true
          example: "2024-12-31T23:59:59Z"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
      required: [id, title, status, projectId, createdAt]

    # === REQUEST SCHEMAS ===
    RegisterRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        password:
          type: string
          minLength: 8
          format: password
          pattern: "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d@$!%*#?&]{8,}$"
          example: "SecurePass123!"
      required: [name, email, password]

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: "john@example.com"
        password:
          type: string
          format: password
          example: "SecurePass123!"
      required: [email, password]

    CreateProjectRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          example: "New Project"
        description:
          type: string
          nullable: true
          example: "Project description"
      required: [name]

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          nullable: true
        description:
          type: string
          nullable: true

    CreateTaskRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: "New Task"
        description:
          type: string
          nullable: true
          example: "Task description"
        status:
          type: string
          enum: [todo, in_progress, done]
          default: todo
        priority:
          type: string
          enum: [low, medium, high]
          default: medium
        assigneeId:
          type: string
          format: uuid
          nullable: true
        dueDate:
          type: string
          format: date-time
          nullable: true
      required: [title]

    # === RESPONSE SCHEMAS ===
    AuthResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT access token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        user:
          $ref: '#/components/schemas/User'
      required: [token, user]

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
        checks:
          type: object
          properties:
            database:
              type: string
              enum: [up, down]
            redis:
              type: string
              enum: [up, down]
            memory:
              type: string
              enum: [up, down]
      required: [status, timestamp]

    PaginatedProjects:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        pagination:
          type: object
          properties:
            total:
              type: integer
              example: 100
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 20
            pages:
              type: integer
              example: 5

    PaginatedTasks:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Task'
        pagination:
          $ref: '#/components/schemas/PaginatedProjects/properties/pagination'

    # === ERROR SCHEMAS ===
    Error:
      type: object
      properties:
        error:
          type: string
          example: "NOT_FOUND"
        message:
          type: string
          example: "Resource not found"
        code:
          type: string
          example: "ERR-404"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
      required: [error, message, timestamp]

    ValidationError:
      allOf:
        - $ref: '#/components/schemas/Error'
        - type: object
          properties:
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                    example: "email"
                  message:
                    type: string
                    example: "Invalid email format"
                  code:
                    type: string
                    example: "invalid_email"
